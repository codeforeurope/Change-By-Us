{#
 # Copyright (c) 2011 Local Projects. All rights reserved.
 # Licensed under the Affero GNU GPL v3, see LICENSE for more details.
 #}
{% extends "./partials/base.html" %}

{% block title %} {{ _('Idea') }} {% endblock title %}

{% block javascript_header %}
{{ super() }}

{% endblock %}<!--end javascript_header-->
{% block continent %}

        <div class='continent idea-page'>

            <div class="west idea-page">

                <div class="hd">
						<span class="see-all-control control"><a href="/search/#ideas">{{ _('See all') }} {{ _('Ideas') }} <span class="sm-arrow-forward light"></span></a></span>
					</div>

                <!-- start Ideas results -->
				<div class="box results-box results-ideas clearfix">




                            {% if d.template_data and d.template_data.user %}
                            <div class="note-card-public-controls">
                                {% if d.template_data.user.data.projects|length > 0 and not(d.template_data.user.data.u_id == d.template_data.idea.data.idea_user_id ) %}
                                    <a class="invite rounded-button small" href="#invite,{{ d.template_data.idea.data.idea_id }},{{ d.template_data.idea.data.idea_user_name }}">Invite</a>
                                {% endif %}
                                <span class="flag"><a href="#flagIdea,{{ d.template_data.idea.data.idea_id }}" class='flag-idea'>{{ _('Flag as Inappropriate') }}</a></span>
                            </div>
                            {% endif %}
                            <div class="note-card">
                                <div class="membrane">
                                    {% if d.template_data and d.template_data.user %}
                                        {% if d.template_data.user.is_admin or d.template_data.user.data.u_id == d.template_data.idea.data.idea_user_id %}
                                        <a class="close remove-idea" href="#removeIdea,{{ d.template_data.idea.data.idea_id }}"><span>{{ _('Close') }}</span></a>
                                        {% endif %}
                                    {% endif %}
                                    {% if d.template_data.idea.data.idea_user_id %}
                                        <cite class="note-meta-hd">
                                            <strong>
                                                <a href="/useraccount/{{ d.template_data.idea.data.idea_user_id }}">{{ d.template_data.idea.data.idea_user_name|truncate(18) }}</a>
                                            </strong> {{ _('said') }} &mdash;
                                        </cite>
                                    {% endif %}
                                    <blockquote>{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}{% if not d.template_data.idea.data.idea_id %}<span class="topright-spacer"></span>{% endif %}{% endif %}<p>{{ d.template_data.idea.data.idea_description|truncate(175) }}</p></blockquote>
                                    <cite class="note-meta-ft">{{ _('Posted') }} <strong class="time-since">{{ d.template_data.idea.data.created }}</strong> {{ _('via') }} <strong>{{ d.template_data.idea.data.submission_type }}</strong></cite>
                                    <div class="like-container">
                                        {%if d.template_data.idea.data.liked == False %}<a href="#likeIdea,{{ d.template_data.idea.data.idea_id }}" class='fancy-caps like-idea'>{% else %}<a href="#unlikeIdea,{{ d.template_data.idea.data.idea_id }}" class='fancy-caps unlike-idea'>{% endif %}<span class="like-count">{{ d.template_data.idea.data.likes }}</span></a>
                                    </div>
                                </div>
                            </div>


					<div class="ft">
						<a class="rounded-button small fancy-caps more-link" href="/">{{ _('Add <span>an</span> Idea') }} <span class="sm-arrow-forward"></span></a>

					</div>
				</div><!-- end results-box ideas -->
            </div>  <!-- end West -->
            <div class="east idea-page">


                <div class="box box-leaderboard">
                <h3>{{ _('Related <strong>Projects</strong>') }}</h3>
                <ol class="leaderboard">
                    {% for item in d.template_data.related_projects %}
                    <li {% if loop.index is even %}class="every-other"{% endif %}>
                        <table>
                            <tbody>
                                <tr>
                                    <td class="num">{{ loop.index }}</td>
                                    <td class="project-header">
                                        <div class='thumb'>
                                            {% if item.image_id > 0 %}
                                            <a href="/project/{{ item.project_id }}"><img width="60" height="60" src="{{d.template_data.media_root}}images/{{ item.image_id % 10 }}/{{ item.image_id }}.png" alt="" class='proj'/></a>
                                            {% else %}
                                            <img src="/static/images/thumb_genAvatar100.png" width="60" height="60" alt="" class="proj"/>
                                            {% endif %}
                                            <span class="overlay-tag"></span>
                                        </div>
                                        <div class='main'>
                                            <h1><a href="/project/{{ item.project_id }}">{{ item.title|truncate(45) }}</a></h1>
                                            <cite class="meta"><em>{{ _('Created by') }}</em> <a href="/useraccount/{{ item.owner_user_id }}">{{ item.owner_full_display_name }}</a></cite>
                                            <cite class="meta"><em>{{ item.num_members }}</em> {{ _('People') }}</cite>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                    {% if loop.index is even %}
                    <li class="clearrow">
                    </li>
                    {% endif %}
                    {% endfor %}
                </ol>
                <div style="clear:both"></div>
            </div>



            </div> <!-- end East -->

            <!-- Conversation -->
            <div class="bottom">
            {% include "partials/idea_conversation.html" %}
            </div>

<!-- Templates for modal view when user is not logged in yet -->
        <div class='template-content modal-content join-no-user'>
        <h2>{{ _('<strong>Hold your horses!</strong> Please register.') }}</h2>
        <p>{{ _('You must <strong><a href="/join">register</a></strong> or <strong><a href="/login">login</a></strong> with %(sitename)s in order to vote for an idea.')|format(sitename=d.config.site.name) }}</p>
        <a class='close' href="#"><span>{{ _('close') }}</span></a>
    </div>


        </div>
{% endblock continent %}
{% block page_js %}
    <script type="text/javascript">
        {% if d.template_data.user %}
            app_page.data.user = {{ d.template_data.user.json }};
        {% endif %}
    </script>
    <script>
        {% if d.template_data.idea.data %}
            app_page.data.idea = {{ d.template_data.idea.json }};
        {% endif %}
    </script>
    <script type="text/javascript" src='/static/js/pages/idea.js'></script>
    <script>
        app_page.messages = { 'like-idea':'{{ _('Like') }}', 'unlike-idea': '{{ _('Unlike') }}', 'liked-idea': '{{ _('Liked!') }}', 'unliked-idea': '{{ _('Unliked!') }}' };
    </script>
{% endblock %}